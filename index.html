<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Monitoreo Comedor UNJ</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Arial', sans-serif;
        }

        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            overflow: hidden;
        }

        .header {
            background: #2c3e50;
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .header h2 {
            font-size: 1.3em;
            font-weight: 300;
            opacity: 0.9;
        }

        .status-section {
            padding: 40px;
            text-align: center;
            background: #f8f9fa;
        }

        .aforo-display {
            background: white;
            border-radius: 10px;
            padding: 30px;
            margin: 20px 0;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .aforo-number {
            font-size: 4em;
            font-weight: bold;
            color: #2c3e50;
        }

        .aforo-total {
            font-size: 1.5em;
            color: #7f8c8d;
        }

        .estado-badge {
            display: inline-block;
            padding: 15px 30px;
            border-radius: 50px;
            font-size: 1.5em;
            font-weight: bold;
            margin: 20px 0;
        }

        .vacio { background: #27ae60; color: white; }
        .medio { background: #f39c12; color: white; }
        .lleno { background: #e74c3c; color: white; }

        .recomendacion {
            font-size: 1.3em;
            margin: 20px 0;
            padding: 20px;
            background: #ecf0f1;
            border-radius: 10px;
            border-left: 5px solid #3498db;
        }

        .horarios {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 30px 0;
        }

        .horario-card {
            background: white;
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .horario-card h3 {
            color: #2c3e50;
            margin-bottom: 15px;
            border-bottom: 2px solid #3498db;
            padding-bottom: 10px;
        }

        .horario-item {
            display: flex;
            justify-content: space-between;
            margin: 10px 0;
            padding: 8px 0;
            border-bottom: 1px solid #ecf0f1;
        }

        .tiempo-cola {
            font-size: 1.2em;
            color: #e74c3c;
            font-weight: bold;
            margin: 15px 0;
        }

        .last-update {
            text-align: center;
            color: #7f8c8d;
            margin-top: 20px;
            font-style: italic;
        }

        .chart-container {
            background: white;
            padding: 25px;
            border-radius: 10px;
            margin: 20px 0;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
        }

        .stat-number {
            font-size: 2em;
            font-weight: bold;
            color: #2c3e50;
        }

        .stat-label {
            color: #7f8c8d;
            margin-top: 5px;
        }

        @media (max-width: 768px) {
            .horarios {
                grid-template-columns: 1fr;
            }
            
            .aforo-number {
                font-size: 3em;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Encabezado -->
        <div class="header">
            <h1>üçΩÔ∏è COMEDOR UNIVERSITARIO UNJ</h1>
            <h2>Software de Monitoreo y Gesti√≥n de Colas</h2>
        </div>

        <!-- Secci√≥n de Estado Actual -->
        <div class="status-section">
            <div class="aforo-display">
                <h2>üë• AFORO ACTUAL</h2>
                <div class="aforo-number" id="aforoActual">--</div>
                <div class="aforo-total" id="aforoTotal">de 100 personas</div>
                
                <div class="estado-badge" id="estadoBadge">VAC√çO</div>
                
                <div class="tiempo-cola" id="tiempoCola">
                    ‚è∞ Tiempo estimado de cola: -- minutos
                </div>
                
                <div class="recomendacion" id="recomendacion">
                    üí° <strong>RECOMENDACI√ìN:</strong> El sistema se est√° inicializando...
                </div>
            </div>

            <!-- Estad√≠sticas r√°pidas -->
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-number" id="porcentajeOcupacion">--%</div>
                    <div class="stat-label">Ocupaci√≥n</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="personasRestantes">--</div>
                    <div class="stat-label">Lugares disponibles</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="tasaEntrada">--/h</div>
                    <div class="stat-label">Personas entrando</div>
                </div>
            </div>

            <!-- Gr√°fico de aforo -->
            <div class="chart-container">
                <h3>üìä HIST√ìRICO DE AFORO - HOY</h3>
                <canvas id="aforoChart"></canvas>
            </div>

            <!-- Horarios -->
            <div class="horarios">
                <!-- Estudiantes Beneficiarios -->
                <div class="horario-card">
                    <h3>üéì ESTUDIANTES BENEFICIARIOS</h3>
                    <div class="horario-item">
                        <span>üç≥ Desayuno:</span>
                        <span>6:30 - 8:50 AM</span>
                    </div>
                    <div class="horario-item">
                        <span>üç≤ Almuerzo:</span>
                        <span>11:00 - 14:30 PM</span>
                    </div>
                    <div class="horario-item">
                        <span>üçõ Cena:</span>
                        <span>15:30 - 16:30 PM</span>
                    </div>
                </div>

                <!-- Estudiantes Libres -->
                <div class="horario-card">
                    <h3>üìö ESTUDIANTES LIBRES</h3>
                    <div class="horario-item">
                        <span>üç≥ Desayuno:</span>
                        <span>6:30 - 8:50 AM</span>
                    </div>
                    <div class="horario-item">
                        <span>üç≤ Almuerzo:</span>
                        <span>13:30 - 14:00 PM</span>
                    </div>
                    <div class="horario-item">
                        <span>üçõ Cena:</span>
                        <span>16:30 - 17:00 PM</span>
                    </div>
                </div>
            </div>

            <div class="last-update" id="lastUpdate">
                üîÑ Sistema en configuraci√≥n - Pr√≥ximamente: Monitoreo en tiempo real
            </div>
        </div>
    </div>
    <script>
        // =============================================
        // SISTEMA DE MONITOREO EN TIEMPO REAL - COMEDOR UNJ
        // CONEXI√ìN CON TINKERCAD + SIMULACI√ìN INTELIGENTE
        // =============================================

        // Configuraci√≥n del sistema
        const config = {
            capacidadMaxima: 100,
            urlDatos: 'datos.json',
            intervaloActualizacion: 3000, // 3 segundos
            modo: 'automatico' // 'automatico' o 'tinkercad'
        };

        // Estado global
        let estado = {
            aforoActual: 0,
            historico: [],
            ultimaConexion: null,
            modoOperacion: 'simulacion'
        };

        // Elementos HTML
        const elementos = {
            aforoActual: document.getElementById('aforoActual'),
            aforoTotal: document.getElementById('aforoTotal'),
            estadoBadge: document.getElementById('estadoBadge'),
            tiempoCola: document.getElementById('tiempoCola'),
            recomendacion: document.getElementById('recomendacion'),
            porcentajeOcupacion: document.getElementById('porcentajeOcupacion'),
            personasRestantes: document.getElementById('personasRestantes'),
            tasaEntrada: document.getElementById('tasaEntrada'),
            lastUpdate: document.getElementById('lastUpdate')
        };

        // Inicializar gr√°fico
        const ctx = document.getElementById('aforoChart').getContext('2d');
        const aforoChart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: [],
                datasets: [{
                    label: 'Personas en el comedor',
                    data: [],
                    borderColor: '#3498db',
                    backgroundColor: 'rgba(52, 152, 219, 0.1)',
                    borderWidth: 3,
                    fill: true,
                    tension: 0.4
                }]
            },
            options: {
                responsive: true,
                plugins: {
                    title: {
                        display: true,
                        text: 'Evoluci√≥n del aforo durante el d√≠a'
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        max: config.capacidadMaxima,
                        title: {
                            display: true,
                            text: 'Personas'
                        }
                    },
                    x: {
                        title: {
                            display: true,
                            text: 'Hora del d√≠a'
                        }
                    }
                }
            }
        });

        // =============================================
        // SIMULACI√ìN INTELIGENTE (CUANDO NO HAY TINKERCAD)
        // =============================================
        function simularAforoRealista() {
            const ahora = new Date();
            const hora = ahora.getHours();
            const minutos = ahora.getMinutes();
            const horaDecimal = hora + minutos / 60;

            let aforoBase = 0;

            // Simulaci√≥n basada en horarios reales del comedor UNJ
            if (horaDecimal >= 6.5 && horaDecimal <= 8.83) { // Desayuno
                aforoBase = 20 + Math.sin((horaDecimal - 6.5) * 2) * 25;
            } else if (horaDecimal >= 11 && horaDecimal <= 14.5) { // Almuerzo beneficiarios
                if (horaDecimal >= 11 && horaDecimal <= 13) {
                    // Hora pico almuerzo
                    aforoBase = 40 + Math.sin((horaDecimal - 11) * 3) * 35;
                } else {
                    // Final del almuerzo
                    aforoBase = 60 - (horaDecimal - 13) * 25;
                }
            } else if (horaDecimal >= 15.5 && horaDecimal <= 16.5) { // Cena beneficiarios
                aforoBase = 30 + Math.sin((horaDecimal - 15.5) * 4) * 20;
            } else if (horaDecimal >= 13.5 && horaDecimal <= 14) { // Almuerzo libres
                aforoBase = Math.min(estado.aforoActual + 15, 80);
            } else if (horaDecimal >= 16.5 && horaDecimal <= 17) { // Cena libres
                aforoBase = Math.min(estado.aforoActual + 10, 70);
            } else {
                // Fuera de horarios - disminuci√≥n gradual
                aforoBase = Math.max(0, estado.aforoActual - 2);
            }

            // Agregar variaci√≥n aleatoria realista
            const variacion = (Math.random() - 0.5) * 10;
            return Math.max(0, Math.min(config.capacidadMaxima, Math.round(aforoBase + variacion)));
        }

        // =============================================
        // FUNCIONES DE ACTUALIZACI√ìN DE INTERFAZ
        // =============================================
        function calcularTiempoCola(aforo) {
            const porcentaje = (aforo / config.capacidadMaxima) * 100;
            
            if (porcentaje < 30) return "0-2";
            if (porcentaje < 50) return "3-5";
            if (porcentaje < 70) return "6-10";
            if (porcentaje < 90) return "11-15";
            return "15+";
        }

        function generarRecomendacion(aforo) {
            const porcentaje = (aforo / config.capacidadMaxima) * 100;
            
            if (porcentaje < 30) {
                return "‚úÖ <strong>CONDICI√ìN IDEAL:</strong> Comedor vac√≠o, puedes ir sin problemas";
            } else if (porcentaje < 50) {
                return "üü° <strong>BUENA OPORTUNIDAD:</strong> Pocas personas, encontrar√°s lugar r√°pido";
            } else if (porcentaje < 70) {
                return "üü† <strong>OCUPACI√ìN MEDIA:</strong> Puedes ir, probablemente encuentres lugar";
            } else if (porcentaje < 90) {
                return "üî¥ <strong>ALTA OCUPACI√ìN:</strong> Considera esperar o ir en otro horario";
            } else {
                return "üö´ <strong>COMPLETAMENTE LLENO:</strong> Mejor espera a que salgan algunas personas";
            }
        }

        function actualizarInterfaz(datos) {
            const ahora = new Date();
            
            // Usar datos de Tinkercad o simulaci√≥n
            if (datos && datos.aforo !== undefined) {
                estado.aforoActual = datos.aforo;
                estado.modoOperacion = 'tinkercad';
                estado.ultimaConexion = ahora;
            } else {
                estado.aforoActual = simularAforoRealista();
                estado.modoOperacion = 'simulacion';
            }
            
            // Calcular m√©tricas
            const porcentaje = Math.round((estado.aforoActual / config.capacidadMaxima) * 100);
            const disponibles = config.capacidadMaxima - estado.aforoActual;
            const tiempoCola = calcularTiempoCola(estado.aforoActual);
            const recomendacion = generarRecomendacion(estado.aforoActual);
            
            // Actualizar elementos HTML
            elementos.aforoActual.textContent = estado.aforoActual;
            elementos.porcentajeOcupacion.textContent = `${porcentaje}%`;
            elementos.personasRestantes.textContent = disponibles;
            elementos.tasaEntrada.textContent = `${Math.round(20 + Math.random() * 15)}/h`;
            elementos.tiempoCola.textContent = `‚è∞ Tiempo estimado de cola: ${tiempoCola} minutos`;
            elementos.recomendacion.innerHTML = recomendacion;
            
            // Informaci√≥n de conexi√≥n
            let infoConexion = `üîÑ Actualizado: ${ahora.toLocaleTimeString()}`;
            if (estado.modoOperacion === 'tinkercad') {
                infoConexion += ' üîó Conectado a Tinkercad';
            } else {
                infoConexion += ' ü§ñ Modo simulaci√≥n autom√°tica';
            }
            elementos.lastUpdate.textContent = infoConexion;
            
            // Actualizar badge de estado
            elementos.estadoBadge.className = 'estado-badge ';
            if (porcentaje < 40) {
                elementos.estadoBadge.classList.add('vacio');
                elementos.estadoBadge.textContent = 'VAC√çO';
            } else if (porcentaje < 75) {
                elementos.estadoBadge.classList.add('medio');
                elementos.estadoBadge.textContent = 'MEDIA OCUPACI√ìN';
            } else {
                elementos.estadoBadge.classList.add('lleno');
                elementos.estadoBadge.textContent = 'ALTO AFORO';
            }
            
            // Actualizar hist√≥rico para el gr√°fico
            const horaActual = ahora.toLocaleTimeString('es-ES', { hour: '2-digit', minute: '2-digit' });
            estado.historico.push({
                hora: horaActual,
                aforo: estado.aforoActual,
                modo: estado.modoOperacion
            });
            
            // Mantener solo √∫ltimos 20 puntos
            if (estado.historico.length > 20) {
                estado.historico.shift();
            }
            
            // Actualizar gr√°fico
            aforoChart.data.labels = estado.historico.map(item => item.hora);
            aforoChart.data.datasets[0].data = estado.historico.map(item => item.aforo);
            aforoChart.update();
        }

        // =============================================
        // CONEXI√ìN CON ARCHIVO DE DATOS (TINKERCAD)
        // =============================================
        async function cargarDatosTinkercad() {
            try {
                // Agregar timestamp para evitar cache
                const url = `${config.urlDatos}?t=${Date.now()}`;
                const respuesta = await fetch(url);
                
                if (respuesta.ok) {
                    const datos = await respuesta.json();
                    return datos;
                }
            } catch (error) {
                console.log('Modo simulaci√≥n: Sin conexi√≥n a Tinkercad');
            }
            return null;
        }

        // =============================================
        // SISTEMA PRINCIPAL
        // =============================================
        async function actualizarSistema() {
            const datosTinkercad = await cargarDatosTinkercad();
            actualizarInterfaz(datosTinkercad);
        }

        function inicializarSistema() {
            // Primera actualizaci√≥n inmediata
            actualizarSistema();
            
            // Actualizar peri√≥dicamente
            setInterval(actualizarSistema, config.intervaloActualizacion);
            
            console.log("‚úÖ Sistema Comedor UNJ - Inicializado");
            console.log("üì° Modos: Tinkercad (conexi√≥n) | Simulaci√≥n (autom√°tico)");
        }

        // Iniciar cuando la p√°gina cargue
        document.addEventListener('DOMContentLoaded', inicializarSistema);
    </script>
   
</html>
